<div class="container-fluid p-4">
  <!-- Header Actions -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <button class="btn btn-outline-secondary" (click)="goBack()">
      <i class="fa-solid fa-arrow-right me-2"></i>
      رجوع
    </button>
    <button class="btn btn-primary" (click)="openAddModal()">
      <i class="fa-solid fa-plus me-2"></i>
      إضافة موقع جديد
    </button>
  </div>

  <!-- Search and Filter -->
  <div class="row mb-4">
    <div class="col-md-8">
      <div class="input-group">
        <span class="input-group-text bg-white">
          <i class="fa-solid fa-search text-muted"></i>
        </span>
        <input
          type="text"
          class="form-control"
          placeholder="بحث عن موقع..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="searchTerm.set($event)"
        />
      </div>
    </div>
    <div class="col-md-4">
      <select class="form-select" [(ngModel)]="filterType" (ngModelChange)="filterType.set($event)">
        <option *ngFor="let type of filterTypes" [value]="type">{{ type }}</option>
      </select>
    </div>
  </div>

  <!-- Locations List -->
  <div class="card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>اسم الموقع</th>
              <th>النوع</th>
              <th>العنوان</th>
              <th>المدينة</th>
              <th>رقم الهاتف</th>
              <th>تاريخ الإضافة</th>
              <th>الحالة</th>
              <th class="text-center">الإجراءات</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let location of filteredLocations()">
              <td class="fw-medium">{{ location.name }}</td>
              <td>
                <span class="badge bg-info text-dark">{{ getTypeLabel(location.type) }}</span>
              </td>
              <td class="text-muted">{{ location.address }}</td>
              <td>{{ location.city }}</td>
              <td dir="ltr" class="text-end">{{ location.phoneNumber }}</td>
              <td>{{ location.createdAt | date: 'dd/MM/yyyy' }}</td>
              <td>
                <span class="badge" [class.bg-success]="location.isActive" [class.bg-secondary]="!location.isActive">
                  {{ location.isActive ? 'نشط' : 'غير نشط' }}
                </span>
              </td>
              <td>
                <div class="d-flex justify-content-center gap-2">
                  <button class="btn btn-sm btn-outline-primary" (click)="openEditModal(location)" title="تعديل">
                    <i class="fa-solid fa-edit"></i>
                  </button>
                  <button
                    class="btn btn-sm"
                    [class.btn-outline-success]="!location.isActive"
                    [class.btn-outline-warning]="location.isActive"
                    (click)="toggleStatus(location)"
                    [title]="location.isActive ? 'تعطيل' : 'تفعيل'">
                    <i class="fa-solid" [class.fa-check]="!location.isActive" [class.fa-ban]="location.isActive"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="deleteLocation(location)" title="حذف">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="filteredLocations().length === 0">
              <td colspan="8" class="text-center text-muted py-4">
                <i class="fa-solid fa-inbox fa-2x mb-2 d-block"></i>
                لا توجد مواقع
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Add Modal -->
<div class="modal fade" [class.show]="isAddModalOpen()" [style.display]="isAddModalOpen() ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">إضافة موقع جديد</h5>
        <button type="button" class="btn-close" (click)="closeAddModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">اسم الموقع <span class="text-danger">*</span></label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="locationForm.name"
                name="name"
                placeholder="مثال: مستشفى الملك فيصل"
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">نوع الموقع <span class="text-danger">*</span></label>
              <select class="form-select" [(ngModel)]="locationForm.type" name="type">
                <option *ngFor="let type of locationTypes" [value]="type.value">{{ type.label }}</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-md-8 mb-3">
              <label class="form-label">العنوان <span class="text-danger">*</span></label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="locationForm.address"
                name="address"
                placeholder="مثال: طريق الملك فهد"
              />
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">المدينة <span class="text-danger">*</span></label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="locationForm.city"
                name="city"
                placeholder="مثال: الرياض"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">رقم الهاتف <span class="text-danger">*</span></label>
              <input
                type="tel"
                class="form-control"
                [(ngModel)]="locationForm.phoneNumber"
                name="phoneNumber"
                placeholder="0501234567"
                dir="ltr"
              />
            </div>
            <div class="col-md-6 mb-3 d-flex align-items-end">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  [(ngModel)]="locationForm.isActive"
                  name="isActive"
                  id="addIsActive"
                />
                <label class="form-check-label" for="addIsActive">
                  نشط
                </label>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeAddModal()">إلغاء</button>
        <button type="button" class="btn btn-primary" (click)="addLocation()">
          <i class="fa-solid fa-plus me-2"></i>
          إضافة
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="isAddModalOpen()" *ngIf="isAddModalOpen()"></div>

<!-- Edit Modal -->
<div class="modal fade" [class.show]="isEditModalOpen()" [style.display]="isEditModalOpen() ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">تعديل الموقع</h5>
        <button type="button" class="btn-close" (click)="closeEditModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">اسم الموقع <span class="text-danger">*</span></label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="locationForm.name"
                name="name"
                placeholder="مثال: مستشفى الملك فيصل"
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">نوع الموقع <span class="text-danger">*</span></label>
              <select class="form-select" [(ngModel)]="locationForm.type" name="type">
                <option *ngFor="let type of locationTypes" [value]="type.value">{{ type.label }}</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-md-8 mb-3">
              <label class="form-label">العنوان <span class="text-danger">*</span></label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="locationForm.address"
                name="address"
                placeholder="مثال: طريق الملك فهد"
              />
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">المدينة <span class="text-danger">*</span></label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="locationForm.city"
                name="city"
                placeholder="مثال: الرياض"
              />
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">رقم الهاتف <span class="text-danger">*</span></label>
              <input
                type="tel"
                class="form-control"
                [(ngModel)]="locationForm.phoneNumber"
                name="phoneNumber"
                placeholder="0501234567"
                dir="ltr"
              />
            </div>
            <div class="col-md-6 mb-3 d-flex align-items-end">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  [(ngModel)]="locationForm.isActive"
                  name="isActive"
                  id="editIsActive"
                />
                <label class="form-check-label" for="editIsActive">
                  نشط
                </label>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeEditModal()">إلغاء</button>
        <button type="button" class="btn btn-primary" (click)="updateLocation()">
          <i class="fa-solid fa-save me-2"></i>
          حفظ التغييرات
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="isEditModalOpen()" *ngIf="isEditModalOpen()"></div>
