<div dir="rtl" class="container py-4">

    <main class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card shadow-sm mb-4 text-center">
                <div class="card-body">
                    <div class="position-relative d-inline-block mb-3">
                        <img
                            [src]="userProfile().profileImage || 'geminiBroNotPro.png'"
                            alt="صورة الملف الشخصي"
                            class="rounded-circle border border-5 border-white"
                            style="width: 112px; height: 112px; object-fit: cover;">
                        <input
                            type="file"
                            #fileInput
                            class="d-none"
                            accept="image/*"
                            (change)="onImageSelected($event)"
                        />
                        <button
                            class="btn btn-primary rounded-circle position-absolute bottom-0 end-0 p-1"
                            (click)="fileInput.click()">
                            <i class="fa-solid fa-pen" style="font-size: 0.75rem;"></i>
                        </button>
                    </div>

                    <h2 class="h4 fw-bold text-dark mb-1">{{ userProfile().name }}</h2>
                    <p class="text-secondary mb-3">{{ getRoleLabel(userProfile().role) }}</p>

                    <div class="d-flex justify-content-center gap-4">
                        <div class="d-flex align-items-center">
                            <i class="fa-solid fa-envelope text-secondary me-2"></i>
                            <p class="text-dark mb-0 small">{{ userProfile().email }}</p>
                        </div>
                        <div class="d-flex align-items-center">
                            <i class="fa-solid fa-phone text-secondary me-2"></i>
                            <p class="text-dark mb-0 small">{{ userProfile().phone }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h3 class="h5 fw-bold text-dark mb-4">التفاصيل الشخصية</h3>

                    <form>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="fullName" class="form-label fw-medium">الاسم الكامل</label>
                                <input
                                    type="text"
                                    id="fullName"
                                    class="form-control"
                                    [(ngModel)]="profileForm.name"
                                    name="fullName">
                            </div>

                            <div class="col-md-6">
                                <label for="email" class="form-label fw-medium">البريد الإلكتروني</label>
                                <input
                                    type="email"
                                    id="email"
                                    class="form-control"
                                    [(ngModel)]="profileForm.email"
                                    name="email">
                            </div>

                            <div class="col-md-6">
                                <label for="phone" class="form-label fw-medium">الهاتف</label>
                                <input
                                    type="tel"
                                    id="phone"
                                    class="form-control"
                                    [(ngModel)]="profileForm.phone"
                                    name="phone"
                                    dir="ltr">
                            </div>

                            <div class="col-md-6">
                                <label for="nationalId" class="form-label fw-medium">الهوية الوطنية</label>
                                <input
                                    type="text"
                                    id="nationalId"
                                    class="form-control"
                                    [(ngModel)]="profileForm.nationalId"
                                    name="nationalId"
                                    dir="ltr">
                            </div>

                            <div class="col-md-6">
                                <label for="dob" class="form-label fw-medium">تاريخ الميلاد</label>
                                <input
                                    type="date"
                                    id="dob"
                                    class="form-control"
                                    [(ngModel)]="profileForm.dateOfBirth"
                                    name="dob">
                            </div>

                            <div class="col-md-6">
                                <label for="city" class="form-label fw-medium">المدينة</label>
                                <input
                                    type="text"
                                    id="city"
                                    class="form-control"
                                    [(ngModel)]="profileForm.city"
                                    name="city">
                            </div>

                            <div class="col-12">
                                <label for="address" class="form-label fw-medium">العنوان</label>
                                <input
                                    type="text"
                                    id="address"
                                    class="form-control"
                                    [(ngModel)]="profileForm.address"
                                    name="address">
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h3 class="h5 fw-bold text-dark mb-4">الأمان</h3>
                    <button
                        class="btn btn-outline-secondary d-flex justify-content-between align-items-center w-100 p-3"
                        (click)="openChangePasswordModal()">
                        <span>تغيير كلمة المرور</span>
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="fixed-bottom bg-white border-top p-3 shadow-lg">
        <div class="container">
            <div class="row g-3 justify-content-center">
                <div class="col-12 col-sm-6 col-lg-4 d-grid">
                    <button class="btn btn-secondary btn-lg" (click)="cancelChanges()">إلغاء التعديلات</button>
                </div>
                <div class="col-12 col-sm-6 col-lg-4 d-grid">
                    <button class="btn btn-primary btn-lg" (click)="saveProfile()">حفظ التغييرات</button>
                </div>
            </div>
        </div>
    </footer>
</div>

<!-- Change Password Modal -->
<div class="modal fade" [class.show]="isChangePasswordModalOpen()" [style.display]="isChangePasswordModalOpen() ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">تغيير كلمة المرور</h5>
        <button type="button" class="btn-close" (click)="closeChangePasswordModal()"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info" role="alert">
          <i class="fa-solid fa-info-circle me-2"></i>
          يمكنك تغيير كلمة المرور دون الحاجة لمعرفة كلمة المرور الحالية
        </div>
        <form>
          <div class="mb-3">
            <label class="form-label">كلمة المرور الجديدة <span class="text-danger">*</span></label>
            <input
              type="password"
              class="form-control"
              [(ngModel)]="passwordForm.newPassword"
              name="newPassword"
              placeholder="••••••••"
            />
            <small class="text-muted">يجب أن تكون 6 أحرف على الأقل</small>
          </div>
          <div class="mb-3">
            <label class="form-label">تأكيد كلمة المرور الجديدة <span class="text-danger">*</span></label>
            <input
              type="password"
              class="form-control"
              [(ngModel)]="passwordForm.confirmPassword"
              name="confirmPassword"
              placeholder="••••••••"
            />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeChangePasswordModal()">إلغاء</button>
        <button type="button" class="btn btn-primary" (click)="changePassword()">
          <i class="fa-solid fa-save me-2"></i>
          حفظ كلمة المرور
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="isChangePasswordModalOpen()" *ngIf="isChangePasswordModalOpen()"></div>
