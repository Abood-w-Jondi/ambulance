<div class="container-fluid p-4">
  <!-- Header Actions -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <button class="btn btn-outline-secondary" (click)="goBack()">
      <i class="fa-solid fa-arrow-right me-2"></i>
      رجوع
    </button>
    <button class="btn btn-primary" (click)="openAddModal()">
      <i class="fa-solid fa-plus me-2"></i>
      إضافة نوع جديد
    </button>
  </div>

  <!-- Card Grid -->
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4 mb-4">
    @for (type of transportationTypes(); track type.id) {
      <div class="col">
        <div class="card shadow-sm rounded-xl h-100 position-relative"
          [ngClass]="{'opacity-75': !type.isActive}">

          <!-- Action Buttons (top-left corner) -->
          <div class="position-absolute top-0 start-0 m-3 d-flex gap-2">
            <button
              class="btn btn-sm btn-outline-primary rounded-circle"
              style="width: 32px; height: 32px; padding: 0;"
              (click)="openEditModal(type)"
              title="تعديل">
              <i class="fa-solid fa-pen"></i>
            </button>
            <button
              class="btn btn-sm rounded-circle"
              [class.btn-outline-success]="!type.isActive"
              [class.btn-outline-warning]="type.isActive"
              style="width: 32px; height: 32px; padding: 0;"
              (click)="toggleStatus(type)"
              [title]="type.isActive ? 'تعطيل' : 'تفعيل'">
              <i class="fa-solid" [class.fa-check]="!type.isActive" [class.fa-ban]="type.isActive"></i>
            </button>
            <button
              class="btn btn-sm btn-outline-danger rounded-circle"
              style="width: 32px; height: 32px; padding: 0;"
              (click)="deleteType(type)"
              title="حذف">
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>

          <!-- Card Content -->
          <div class="card-body pt-5">
            <h5 class="card-title fw-bold mb-2">{{ type.name }}</h5>
            <p class="text-muted small mb-3">{{ type.description }}</p>

            <p class="small mb-0">
              <span class="badge" [class.bg-success]="type.isActive" [class.bg-secondary]="!type.isActive">
                {{ type.isActive ? 'نشط' : 'غير نشط' }}
              </span>
            </p>
          </div>
        </div>
      </div>
    } @empty {
      <div class="col-12">
        <div class="text-center text-muted py-5">
          <i class="fa-solid fa-inbox fa-3x mb-3 d-block"></i>
          <p class="fs-5">لا توجد أنواع تشخيصات</p>
        </div>
      </div>
    }
  </div>

  <!-- Pagination -->
  <app-pagination
    [currentPage]="currentPage"
    [itemsPerPage]="itemsPerPage"
    [totalItems]="totalRecords"
    (pageChange)="onPageChange($event)"
    (itemsPerPageChange)="onItemsPerPageChange($event)">
  </app-pagination>
</div>

<!-- Add Modal -->
<div class="modal fade" [class.show]="isAddModalOpen()" [style.display]="isAddModalOpen() ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">إضافة نوع تشخيص جديد</h5>
        <button type="button" class="btn-close" (click)="closeAddModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label class="form-label">اسم التشخيص <span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="typeForm.name"
              name="name"
              placeholder="مثال: نقل طوارئ"
            />
          </div>
          <div class="mb-3">
            <label class="form-label">الوصف</label>
            <textarea
              class="form-control"
              [(ngModel)]="typeForm.description"
              name="description"
              rows="3"
              placeholder="وصف التشخيص..."
            ></textarea>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="typeForm.isActive"
              name="isActive"
              id="addIsActive"
            />
            <label class="form-check-label" for="addIsActive">
              نشط
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeAddModal()">إلغاء</button>
        <button type="button" class="btn btn-primary" (click)="addType()">
          <i class="fa-solid fa-plus me-2"></i>
          إضافة
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="isAddModalOpen()" *ngIf="isAddModalOpen()"></div>

<!-- Edit Modal -->
<div class="modal fade" [class.show]="isEditModalOpen()" [style.display]="isEditModalOpen() ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">تعديل التشخيص</h5>
        <button type="button" class="btn-close" (click)="closeEditModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label class="form-label">اسم التشخيص <span class="text-danger">*</span></label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="typeForm.name"
              name="name"
              placeholder="مثال: نقل طوارئ"
            />
          </div>
          <div class="mb-3">
            <label class="form-label">الوصف </label>
            <textarea
              class="form-control"
              [(ngModel)]="typeForm.description"
              name="description"
              rows="3"
              placeholder="وصف التشخيص..."
            ></textarea>
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="typeForm.isActive"
              name="isActive"
              id="editIsActive"
            />
            <label class="form-check-label" for="editIsActive">
              نشط
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeEditModal()">إلغاء</button>
        <button type="button" class="btn btn-primary" (click)="updateType()">
          <i class="fa-solid fa-save me-2"></i>
          حفظ التغييرات
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="isEditModalOpen()" *ngIf="isEditModalOpen()"></div>
<app-confirmation-modal
    [isOpen]="isDeleteModalOpen()"
    [config]="deleteModalConfig()"
    (confirmed)="confirmDelete()"
    (cancelled)="cancelDelete()">
</app-confirmation-modal>